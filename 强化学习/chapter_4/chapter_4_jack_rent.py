# 杰克租车问题

import math

import numpy as np

MAX_CAR = 20
MAX_MOVE = 5
RENT_REWARD = 10
MOVE_REWARD = 2
PARK_FEE = 4
GAMMA = 0.9

POISSON_MAX = 11           # 也就是泊松分布下，最多可以租11个车

FREE_MOVE_1_TO_2= False
OVERNIGHT_PARK_FEE = False

# 定义一个泊松方程的函数
def poisson(k, _lambda):
    return np.exp(-_lambda) * _lambda ** k / math.factorial(k)

def precompute_poisson(_lambda):
    pmf = [poisson(k, _lambda) for k in range(POISSON_MAX + 1)]
    sum = np.sum(pmf)
    pmf[-1] = 1 - sum + pmf[-1] if 1 - sum > 0 else pmf[-1]
    return np.array(pmf)

PMF_RENT = [precompute_poisson(3), precompute_poisson(4)]
PMF_RET = [precompute_poisson(3), precompute_poisson(2)]

def move_cost(a):
    """
    移车花钱
    有两种情况：练习4.7中，1->2第一辆车移动是不花钱的，其余情况都需要花钱
    """
    if not FREE_MOVE_1_TO_2:
        return abs(a) * MOVE_REWARD
    else:
        if a <= 0:
            return abs(a) * MOVE_REWARD
        else:
            return max(0, a-1) * MOVE_REWARD

def park_fee(n1, n2):
    """
    只有在OVERNIGHT_PARK_FEE==True时有停车费, 并且只有大于10辆才有停车费
    :param n1: 地点1中剩余的车辆
    :param n2: 地点2中剩余的车辆
    :return: 返回停车费
    """
    if OVERNIGHT_PARK_FEE:
        return (4 if n1 > 10 else 0) + (4 if n2 > 10 else 0)
    else:
        return 0

def clamp(x, low=0, high = MAX_CAR):
    return max(low, min(x, high))

# 定义一个状态-动作函数 Q(s, a)
def q_state_value(V, s1, s2, a):
    """
    状态为：每天结束后该地点还剩的车辆数，a表示两个地点间移动的车辆数(正数为1->2，负数为2->1),a<=5
    给定状态(s1, s2), 执行动作a后的状态动作价值Q，其中s1是地点1状态，s2是地点2状态
    """
    # 夜间移动的车辆后，地点剩余的车辆数, 区间在[0, MAX_CAR]
    n1 = clamp(s1 - a)
    n2 = clamp(s2 + a)
    # 移动车辆后需要消耗的钱，移车花钱，停车也花钱
    ret = - move_cost(a) - park_fee(n1, n2)

    total = 0.0
    # 白天有租车收入
    for d1, p_d1 in enumerate(PMF_RENT[0]):
        sold1 = min(n1, d1)
        # 剩余的车辆
        rem1 = n1 - sold1
        for d2, p_d2 in enumerate(PMF_RENT[1]):
            sold2 = min(n2, d2)
            rem2 = n2 - sold2
            reward = (sold1 + sold2) * RENT_REWARD
            prob_d = p_d1 * p_d2

            # 归还，归还的车辆第二天可用
            suntotal = 0.0
            for r1, p_r1 in enumerate(PMF_RET[0]):
                # 停车场最多只有20辆
                m1 = clamp(rem1 + r1)
                for r2, p_r2 in enumerate(PMF_RET[1]):
                    m2 = clamp(rem2 + r2)
                    p_trans = p_r1 * p_r2
                    suntotal += p_trans * V[int(m1), int(m2)]
            total += prob_d * (reward + GAMMA * suntotal)
    return ret + total

THETA = 1e-4

# 策略评估
def policy_evaluation(V, policy):
    """
    :param policy: 执行的动作的合集
    :param V: 上一轮的价值状态期望
    :return: 当前轮的价值状态期望
    """
    while True:
        delta = 0
        V_new = V.copy()
        for s1 in range(MAX_CAR + 1):
            for s2 in range(MAX_CAR + 1):
                a = policy[s1, s2]
                V_new[s1, s2] = q_state_value(V, s1, s2, a)
                delta = max(delta, abs(V_new[s1, s2] - V[s1, s2]))
        V = V_new.copy()
        if delta < THETA:
            break
    return V

# 策略改进
def policy_improvement(V, policy):
    """
    :param V:
    :param policy: 动作集
    :return: 新的V和新的policy
    """
    policy_state = True
    for s1 in range(MAX_CAR + 1):
        for s2 in range(MAX_CAR + 1):
            old = policy[s1, s2]
            best_a = old
            best_q = -1e18
            # 移动的车辆不能大于剩余车辆数量，并且移动车辆不能大于MAX_MOVE
            for a in range(-min(s2, MAX_MOVE), min(s1, MAX_MOVE) + 1):
                q = q_state_value(V, s1, s2, a)
                # 贪心选最大的Q(s,a)，当有多个最优（在一个误差范围内）时，选择最小的a对应的q
                if (q > best_q + 1e-12) or (abs(q - best_q) < 1e-12) and (abs(a) < abs(best_a)):
                    best_a, best_q = a, q
            policy[s1, s2] = best_a
            if best_a != old:
                policy_state = False
    return  policy_state, policy

# 开始策略迭代
def policy_iteration():
    V = np.zeros((MAX_CAR+1, MAX_CAR+1), dtype=float)
    policy = np.zeros((MAX_CAR+1, MAX_CAR+1), dtype=int)
    iter_ = 0
    while True:
        iter_ += 1
        V = policy_evaluation(V, policy)
        policy_state, policy = policy_improvement(V, policy)
        print(f"Iteration: {iter_}, stable? {policy_state}")
        if policy_state:
            break
    return V, policy
if __name__ == "__main__":
    from time import time
    start_time = time()
    # 基本的杰克租车问题
    FREE_MOVE_1_TO_2 = False
    OVERNIGHT_PARK_FEE = False
    V, policy = policy_iteration()
    print(f"V: {V}, policy:{policy}")
    print(f"Time: {time() - start_time}")
    # 练习4.7
    FREE_MOVE_1_TO_2 = True
    OVERNIGHT_PARK_FEE = True
    V, policy = policy_iteration()
    print(f"V: {V}, policy:{policy}")
    print(f"Time: {time() - start_time}")


    # C:\miniconda\envs\LLM\python.exe C:\Python\LLM\强化学习\chapter_4_jack_rent.py
    # Iteration: 1, stable? False
    # Iteration: 2, stable? False
    # Iteration: 3, stable? False
    # Iteration: 4, stable? False
    # Iteration: 5, stable? False
    # Iteration: 6, stable? True
    # V: [[421.40954767 431.38176891 441.23746006 450.84278642 460.07561025
    #   468.86775511 477.20614552 485.10994628 492.97324425 500.46908822
    #   507.88117919 514.98688281 521.74414221 528.34449427 534.73848969
    #   540.82726462 546.63288038 552.17152173 557.59644978 562.80284936
    #   567.7560624 ]
    #  [431.28329778 441.25545281 451.11081542 460.71529919 469.9466192
    #   478.73663239 487.07240903 494.97324425 502.46908822 509.88117919
    #   516.98688281 523.74414221 530.34449427 536.73848969 542.82726462
    #   548.63288038 554.17152173 559.59644978 564.80284936 569.7560624
    #   574.44722986]
    #  [440.75684676 450.7286953  460.58253892 470.1831348  479.40754106
    #   488.18781837 496.51179604 504.39949729 511.88117919 518.98688281
    #   525.74414221 532.34449427 538.73848969 544.82726462 550.63288038
    #   556.17152173 561.59644978 566.80284936 571.7560624  576.44722986
    #   580.84163549]
    #  [449.58004046 459.55111322 469.40111576 478.99189586 488.19889943
    #   496.95481431 505.24958969 513.10538878 520.55362126 527.62435979
    #   534.34449427 540.73848969 546.82726462 552.63288038 558.17152173
    #   563.59644978 568.80284936 573.7560624  578.44722986 582.84163549
    #   586.95412429]
    #  [457.67055214 467.64018569 477.48306467 487.05565305 496.23045923
    #   504.94148358 513.1829109  520.9813493  528.37094978 535.38247337
    #   542.04214201 548.3733077  554.39589143 560.13159245 565.59644978
    #   570.80284936 575.7560624  580.44722986 584.84163549 588.95412429
    #   592.87421572]
    #  [465.64018569 475.48306467 485.05565305 494.44632315 503.57190401
    #   512.21439894 520.37478005 528.08701496 535.390191   542.31689994
    #   548.8929966  555.14054928 561.07808499 566.72660173 572.10157005
    #   577.21499757 582.07179302 586.66289261 590.95412429 594.87421572
    #   598.31421891]
    #  [473.48306467 483.05565305 492.44632315 501.57190401 510.35908828
    #   518.90967093 526.96143528 534.55870294 541.74792771 548.56497333
    #   555.03589788 561.18151128 567.01867028 572.56738732 577.84216756
    #   582.85428514 587.60802693 592.0939845  596.27846604 600.09235744
    #   603.43118532]
    #  [481.05565305 490.44632315 499.57190401 508.35908828 516.90967093
    #   525.15599782 533.0750755  540.53183282 547.5823221  554.26716932
    #   560.61337375 566.64069345 572.36420037 577.8027599  582.96964903
    #   587.87519352 592.52293434 596.90307996 600.9823807  604.69368121
    #   607.93645571]
    #  [488.44632315 497.57190401 506.35908828 514.90967093 523.15599782
    #   531.0750755  538.81318113 546.10938451 553.0010284  559.53481611
    #   565.73949001 571.63412034 577.23205667 582.5509991  587.60289143
    #   592.3970426  596.93624459 601.21036701 605.18661113 608.79959891
    #   611.95220872]
    #  [495.57190401 504.35908828 512.90967093 521.15599782 529.0750755
    #   536.81318113 544.23854632 551.36057556 558.07890611 564.44731107
    #   570.49704361 576.24696429 581.70892694 586.89958156 591.82957034
    #   596.50722603 600.93466321 605.10149961 608.97542832 612.49272762
    #   615.55926144]
    #  [502.35908828 510.90967093 519.15599782 527.0750755  534.81318113
    #   542.23854632 549.38934398 556.32957043 562.86560115 569.05890364
    #   574.9439009  580.53977491 585.8572323  590.91209121 595.71382477
    #   600.26989957 604.58186273 608.639182   612.41009744 615.83247704
    #   618.81489339]
    #  [508.90967093 517.15599782 525.0750755  532.81318113 540.23854632
    #   547.38934398 554.32957043 561.04411858 567.3933178  573.40571768
    #   579.11943494 584.55450284 589.72089616 594.63388048 599.3019534
    #   603.73186164 607.92470942 611.86991745 615.53633152 618.86337867
    #   621.76216958]
    #  [515.15599782 523.0750755  530.81318113 538.23854632 545.38934398
    #   552.32957043 559.04411858 565.52120252 571.68207227 577.51056926
    #   583.04891676 588.3185026  593.32900787 598.09544629 602.62555585
    #   606.92551605 610.99610817 614.8267995  618.38709547 621.6179688
    #   624.43296007]
    #  [521.04506763 528.81318113 536.23854632 543.38934398 550.32957043
    #   557.04411858 563.52120252 569.77069743 575.74344051 581.38670093
    #   586.74716027 591.84804335 596.69917977 601.31562914 605.70457736
    #   609.87176963 613.8177608  617.53213707 620.98510276 624.11916119
    #   626.85019578]
    #  [526.63314566 534.23854632 541.38934398 548.32957043 555.04411858
    #   561.52120252 567.77069743 573.79466135 579.5802772  585.03783001
    #   590.21878829 595.14869108 599.83796206 604.30199513 608.54760752
    #   612.58020876 616.40018889 619.99729684 623.34245346 626.37966146
    #   629.02705065]
    #  [531.95253374 539.38934398 546.32957043 553.04411858 559.52120252
    #   565.77069743 571.79466135 577.58483635 583.18501048 588.4571966
    #   593.45795336 598.2155975  602.74158679 607.05192406 611.15321475
    #   615.0505989  618.74433348 622.22435171 625.46229063 628.40359918
    #   630.9685253 ]
    #  [537.02187905 544.28864938 551.04411858 557.52120252 563.77069743
    #   569.79466135 575.58483635 581.18501048 586.53428435 591.62328896
    #   596.44510621 601.03121906 605.3945064  609.55181799 613.50967975
    #   617.27301473 620.8419743  624.2066999  627.33954562 630.18733977
    #   632.67228077]
    #  [541.85228306 548.95038418 555.52120252 561.77069743 567.79466135
    #   573.58483635 579.18501048 584.53428435 589.62328896 594.49425865
    #   599.14256553 603.56198838 607.76707505 611.77567368 615.59433276
    #   619.22781864 622.67623131 625.92997597 628.96215005 631.72089803
    #   634.13017008]
    #  [546.45050918 553.38278421 559.77069743 565.79466135 571.58483635
    #   577.18501048 582.53428435 587.62328896 592.49425865 597.14256553
    #   601.56198838 605.76707505 609.81580888 613.68589205 617.37490596
    #   620.88753218 624.22390765 627.3747917  630.31407894 632.99117736
    #   635.3315744 ]
    #  [550.81731908 557.58720499 563.79466135 569.58483635 575.18501048
    #   580.53428435 585.62328896 590.49425865 595.14256553 599.56198838
    #   603.76707505 607.81580888 611.68589205 615.37490596 618.88753218
    #   622.22440058 625.46279159 628.52383873 631.38227518 633.98870578
    #   636.26993113]
    #  [554.94351785 561.55484881 567.58483635 573.18501048 578.53428435
    #   583.62328896 588.49425865 593.14256553 597.56198838 601.76707505
    #   605.81580888 609.68589205 613.37490596 616.88753218 620.22440058
    #   623.46279159 626.52383873 629.38227518 632.16769112 634.71771818
    #   636.95202722]],
    #   policy:[[ 0  0  0  0  0  0  0  0 -1 -1 -2 -2 -2 -3 -3 -3 -3 -3 -4 -4 -4]
    #  [ 0  0  0  0  0  0  0  0  0 -1 -1 -1 -2 -2 -2 -2 -2 -3 -3 -3 -3]
    #  [ 0  0  0  0  0  0  0  0  0  0  0 -1 -1 -1 -1 -1 -2 -2 -2 -2 -2]
    #  [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 -1 -1 -1 -1 -1 -2]
    #  [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 -1 -1]
    #  [ 1  1  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 2  2  1  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 3  2  2  1  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 3  3  2  2  1  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 4  3  3  2  2  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 4  4  3  3  2  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 5  4  4  3  2  1  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 5  5  4  3  2  2  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 5  5  4  3  3  2  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 5  5  4  4  3  2  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 5  5  5  4  3  2  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 5  5  5  4  3  2  1  1  0  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 5  5  5  4  3  2  2  1  1  0  0  0  0  0  0  0  0  0  0  0  0]
    #  [ 5  5  5  4  3  3  2  2  1  1  1  1  0  0  0  0  0  0  0  0  0]
    #  [ 5  5  5  4  4  3  3  2  2  2  2  1  1  1  1  0  0  0  0  0  0]
    #  [ 5  5  5  5  4  4  3  3  3  3  2  2  2  2  1  1  1  1  0  0  0]]
    # Time: 3368.2745473384857
    # Iteration: 1, stable? False
    # Iteration: 2, stable? False
    # Iteration: 3, stable? False
    # Iteration: 4, stable? False
    # Iteration: 5, stable? True
    # V: [[429.94194682 439.91063378 449.74799493 459.30369612 468.44208223
    #   477.09037874 485.2388453  493.1232862  500.79037342 508.2813156
    #   515.47250094 522.25949797 528.94029614 535.17060905 540.90850321
    #   545.81594428 547.5872243  552.18163537 556.38448581 560.29639517
    #   563.85358099]
    #  [439.91063378 449.80764925 459.64454974 469.19899769 478.33499093
    #   486.97963836 495.1232862  502.79037342 510.2813156  517.47250094
    #   524.25949797 530.94029614 537.17060905 542.90850321 547.81594428
    #   552.00800623 554.18163537 558.38448581 562.29639517 565.85358099
    #   569.12912767]
    #  [449.80764925 459.64454974 469.2098336  478.75915397 487.8853214
    #   496.51491515 504.63859827 512.2813156  519.47250094 526.25949797
    #   532.94029614 539.17060905 544.90850321 549.81594428 554.00800623
    #   557.58203855 560.38448581 564.29639517 567.85358099 571.12912767
    #   574.17033894]
    #  [459.37481389 469.2098336  478.75915397 487.8853214  496.86768859
    #   505.46415364 513.5436779  521.13229984 528.25949797 534.94029614
    #   541.17060905 546.90850321 551.81594428 556.00800623 559.58203855
    #   562.59004849 566.29639517 569.85358099 573.12912767 576.17033894
    #   578.98814357]
    #  [468.39404843 478.22495331 487.7630572  496.86768859 505.46415364
    #   513.72817326 521.73695265 529.23855479 536.26274716 542.8222072
    #   548.90850321 553.81594428 558.00800623 561.58203855 564.59004849
    #   568.29639517 571.85358099 575.12912767 578.17033894 580.98814357
    #   583.55274718]
    #  [476.76985133 486.59414514 496.11431454 505.18459349 513.72817326
    #   521.73695265 529.24872714 536.63400583 543.52039504 549.91841449
    #   555.81594428 560.00800623 563.58203855 566.59004849 570.29639517
    #   573.85358099 577.12912767 580.17033894 582.98814357 585.55274718
    #   587.84424171]
    #  [484.59414514 494.34147459 503.83732392 512.86143966 521.33435238
    #   529.24872714 536.63400583 543.52039504 550.12921093 556.33349649
    #   562.00800623 565.58203855 568.59004849 571.79001891 575.45212348
    #   578.78949723 581.87630261 584.75271477 587.42044958 589.84424171
    #   591.96029261]
    #  [492.34147459 501.83732392 511.01184955 519.97868732 528.36502113
    #   536.16471366 543.40922709 550.12921093 556.33349649 562.1578227
    #   567.58203855 570.59004849 573.04763493 576.53288794 579.94481375
    #   583.06321925 585.95951753 588.66554844 591.17480378 593.44826039
    #   595.42438944]
    #  [499.83732392 509.01184955 517.97868732 526.61758527 534.90088408
    #   542.56592657 549.64681611 556.17483628 562.1578227  567.58203855
    #   572.59004849 575.04763493 577.15233845 580.68241337 583.84925403
    #   586.75367231 589.46092963 591.99382741 594.33868579 596.45413413
    #   598.28202061]
    #  [507.01184955 515.97868732 524.61758527 532.90088408 540.99909528
    #   548.50631824 555.3979001  561.70673955 567.44101074 572.59004849
    #   577.04763493 578.95934187 581.00440572 584.262393   587.19011101
    #   589.88563091 592.40557689 594.76340416 596.93904448 598.88967836
    #   600.56133421]
    #  [513.97868732 522.61758527 530.90088408 538.99909528 546.69086096
    #   554.01224931 560.68361477 566.74182769 572.19796665 577.04763493
    #   580.95934187 581.00440572 584.29825032 587.28757458 589.98081692
    #   592.47047253 594.80360784 596.98471024 598.98803487 600.76986067
    #   602.28081921]
    #  [520.61758527 528.90088408 536.99909528 544.69086096 552.01224931
    #   559.08850353 565.50529244 571.27955887 576.42921797 580.95934187
    #   580.89372955 584.29825032 587.28757458 589.98081692 592.47047253
    #   594.80360784 596.98471024 598.98803487 600.76986067 602.28081921
    #   602.28081921]
    #  [526.90088408 534.99909528 542.69086096 550.01224931 557.08850353
    #   563.50529244 569.27955887 574.42921797 578.95934187 580.34675939
    #   583.26551064 585.28757458 587.98081692 590.47047253 592.80360784
    #   594.98471024 596.98803487 598.76986067 600.28081921 600.28081921
    #   600.30348186]
    #  [532.99909528 540.69086096 548.01224931 555.08850353 561.50529244
    #   567.27955887 572.42921797 576.95934187 579.38127151 583.26551064
    #   585.8011171  586.04385085 588.47047253 590.80360784 592.98471024
    #   594.98803487 596.76986067 598.28081921 599.0915783  600.30348186
    #   600.85753858]
    #  [538.69086096 546.01224931 553.08850353 559.50529244 565.27955887
    #   570.42921797 574.95934187 578.00522401 582.20394325 585.8011171
    #   588.04385085 588.06300173 589.64298358 591.64962096 593.51889827
    #   595.28476084 596.93881213 598.44718189 599.76642394 600.85753858
    #   601.29205018]
    #  [543.98434938 551.08850353 557.50529244 563.27955887 568.42921797
    #   572.95934187 576.1873855  580.75019876 584.69030931 588.04385085
    #   590.06300173 589.89282063 591.20296549 592.99621122 594.66547334
    #   596.24835331 597.73853235 599.10335324 600.30049295 601.29205018
    #   601.69767759]
    #  [544.86883728 551.72610472 557.91203594 563.73999183 569.17073302
    #   574.1873855  578.84546445 583.18163461 586.90958966 590.06300173
    #   591.89282063 591.53197827 592.63121365 594.22947516 595.71343771
    #   597.12615198 598.46503819 599.69987784 600.78989181 601.69767759
    #   602.10865303]
    #  [549.32154324 555.91203594 561.73999183 567.17073302 572.1873855
    #   576.84546445 581.20377438 585.35291796 588.90620658 591.89282063
    #   593.53197827 592.95235814 593.95111586 595.37758583 596.69713773
    #   597.95792496 599.16124644 600.27973549 601.27448577 602.10865303
    #   602.51820525]
    #  [553.32062988 559.64183874 565.17073302 570.1873855  574.84546445
    #   579.20377438 583.35291796 587.2886439  590.69103436 593.53197827
    #   594.95235814 594.11581421 595.14738288 596.42739615 597.60689351
    #   598.73744339 599.82333655 600.83984495 601.75010135 602.51820525
    #   602.90074337]
    #  [556.86226304 562.93114965 568.1873855  572.84546445 577.20377438
    #   581.35291796 585.2886439  588.97555929 592.24235237 594.95235814
    #   596.11581421 594.99678839 596.18574332 597.34529996 598.41047094
    #   599.43424658 600.42267386 601.35311364 602.19067872 602.90074337
    #   603.2289221 ]
    #  [559.97599062 565.82273131 570.84546445 575.20377438 579.35291796
    #   583.2886439  586.97555929 590.37347793 593.52054177 596.11581421
    #   596.99678839 595.77177367 597.03195624 598.09713852 599.07376163
    #   600.01469315 600.92666628 601.78849764 602.5670067  603.2289221
    #   603.48421205]],
    #   policy:[[ 0  0  0  0  0  0  0 -1 -1 -2 -2 -3 -3 -3 -4 -5 -4 -4 -5 -5 -5]
    #  [ 1  0  0  0  0  0  0  0 -1 -1 -2 -2 -2 -3 -4 -5 -3 -4 -4 -4 -4]
    #  [ 1  1  0  0  0  0  0  0  0 -1 -1 -1 -2 -3 -4 -5 -3 -3 -3 -3 -3]
    #  [ 1  1  1  1  0  0  0  0  0  0  0 -1 -2 -3 -4 -5 -2 -2 -2 -2 -2]
    #  [ 1  1  1  1  1  0  0  0  0  0  0 -1 -2 -3 -4 -1 -1 -1 -1 -1 -1]
    #  [ 1  1  1  1  1  1  0  0  0  0  0 -1 -2 -3  0  0  0  0  0  0 -1]
    #  [ 2  1  1  1  1  1  1  1  0  0  0 -1 -2  0  0  0  0  0  0  0  0]
    #  [ 2  2  1  1  1  1  1  1  1  0  0 -1 -2  0  0  0  0  0  0  0  0]
    #  [ 3  2  2  1  1  1  1  1  1  1  0 -1  0  0  0  0  0  0  0  0  0]
    #  [ 3  3  2  2  1  1  1  1  1  1  0 -1  0  0  0  0  0  0  0  0  0]
    #  [ 4  3  3  2  1  1  1  1  1  1  0  1  0  0  0  0  0  0  0  0  0]
    #  [ 4  4  3  2  2  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1]
    #  [ 5  4  3  3  2  2  2  2  2  1  0  2  2  2  2  2  2  2  2  2  0]
    #  [ 5  4  4  3  3  3  3  3  1  1  0 -1  3  3  3  3  3  3  1  1  0]
    #  [ 5  5  4  4  4  4  4  1  1  1  0 -1  1  1  1  1  1  1  1  1  0]
    #  [ 5  5  5  5  5  5  1  1  1  1  0 -1  1  1  1  1  1  1  1  1  0]
    #  [ 5  5  4  4  3  2  1  1  1  1  0 -1  1  1  1  1  1  1  1  1  0]
    #  [ 5  5  5  4  3  2  1  1  1  1  0 -1  1  1  1  1  1  1  1  1  0]
    #  [ 5  5  5  4  3  2  2  1  1  1  0 -1  1  1  1  1  1  1  1  1  0]
    #  [ 5  5  5  4  3  3  2  1  1  1  0 -1  1  1  1  1  1  1  1  1  0]
    #  [ 5  5  5  4  4  3  2  1  1  1  0  1  1  1  1  1  1  1  1  1  0]]
    # Time: 6742.586403608322
    #
    # 进程已结束，退出代码为 0